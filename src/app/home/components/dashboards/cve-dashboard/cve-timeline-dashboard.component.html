<header>
    <div class="header">
        <h1>Common Vulnerabilities Dashboard</h1>
        <div class="button-group">
            <button class="button" routerLink="">&laquo; Home</button>
            <button class="button button2" routerLink="/breach">Next &raquo;</button>
        </div>
    </div>
</header>

<div class="viz-container">
    <!-- <div class="header-section">
        <button class="nav-btn" (click)="goHome()" title="Go to Home">
            <span class="home-icon">üè†</span>
            Home
        </button>
    </div> -->
    <nav class="viz-nav">
        <button *ngFor="let viz of visualizations; let i = index" [class.active]="activeViz === i"
            (click)="setActiveViz(i)" class="nav-btn">
            {{viz.name}}
        </button>
    </nav>

    <div class="viz-content">
        <!-- 1. Gantt Chart -->
        <div *ngIf="activeViz === 0" class="visualization">
            <h2>Gantt Chart - Project Timeline</h2>
            <div #ganttChart class="chart-container"></div>
        </div>

        <!-- 2. Activity Heatmap -->
        <div *ngIf="activeViz === 1" class="visualization">
            <h2>Activity Heatmap - Vulnerability Activity</h2>
            <div #heatmap class="chart-container"></div>
        </div>

        <!-- 3. Network Graph -->
        <div *ngIf="activeViz === 2" class="visualization">
            <h2>Network Graph - Entity Relationships</h2>
            <div #networkGraph class="chart-container"></div>
        </div>

        <!-- 4. Sankey Diagram -->
        <div *ngIf="activeViz === 3" class="visualization">
            <h2>Sankey Diagram - Vulnerability Lifecycle Flow</h2>
            <div #sankeyDiagram class="chart-container"></div>
        </div>

        <!-- 5. Animated Story Map -->
        <div *ngIf="activeViz === 4" class="visualization">
            <h2>Animated Story Map</h2>
            <div class="story-controls">
                <button (click)="playStory()" [disabled]="storyPlaying">Play Story</button>
                <button (click)="pauseStory()" [disabled]="!storyPlaying">Pause</button>
                <button (click)="resetStory()">Reset</button>
            </div>
            <div #storyMap class="chart-container story-container">
                <div class="story-event" *ngFor="let event of processedEvents; let i = index"
                    [class.active]="currentStoryIndex >= i" [class.highlight]="currentStoryIndex === i">
                    <div class="story-date">{{event.date}}</div>
                    <div class="story-content" [innerHTML]="event.sentence"></div>
                </div>
            </div>
        </div>

        <!-- 6. Bubble Chart -->
        <div *ngIf="activeViz === 5" class="visualization">
            <h2>Bubble Chart - Event Impact & Type</h2>
            <div #bubbleChart class="chart-container"></div>
        </div>

        <!-- 7. Metro Map -->
        <div *ngIf="activeViz === 6" class="visualization">
            <h2>Metro Map - Vulnerability Journey</h2>
            <div #metroMap class="chart-container metro-container">
                <svg class="metro-svg">
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"
                            markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#666" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <!-- 8. Kanban Board -->
        <div *ngIf="activeViz === 7" class="visualization">
            <h2>Kanban Board - Vulnerability Management Workflow</h2>
            <div class="kanban-board">
                <div class="kanban-column" *ngFor="let stage of kanbanStages">
                    <h3>{{stage.name}}</h3>
                    <div class="kanban-cards">
                        <div class="kanban-card" *ngFor="let event of stage.events">
                            <div class="card-date">{{event.date}}</div>
                            <div class="card-content" [innerHTML]="event.sentence"></div>
                            <div class="card-type">{{event.type}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 9. Circular Timeline -->
        <div *ngIf="activeViz === 8" class="visualization">
            <h2>Circular Timeline - Vulnerability Lifecycle</h2>

            <!-- Animation Controls -->
            <div class="animation-controls" style="margin-bottom: 20px; text-align: center;">
                <button (click)="startCircularTimelineAnimation()" [disabled]="isAnimating" class="btn btn-primary"
                    style="margin-right: 10px;">
                    <i class="fas fa-play"></i> Start Animation
                </button>
                <button (click)="pauseCircularTimelineAnimation()" [disabled]="!isAnimating" class="btn btn-warning"
                    style="margin-right: 10px;">
                    <i class="fas fa-pause"></i> Pause
                </button>
                <button (click)="resetCircularTimelineAnimation()" class="btn btn-secondary"
                    style="margin-right: 10px;">
                    <i class="fas fa-stop"></i> Reset
                </button>

                <!-- Speed Control -->
                <div style="display: inline-block; margin-left: 20px;">
                    <label for="speedControl" style="margin-right: 10px;">Speed:</label>
                    <input type="range" id="speedControl" min="100" max="3000" step="100" [value]="animationSpeed"
                        (input)="onSpeedChange($event)" style="width: 150px;">
                    <span style="margin-left: 10px;">{{animationSpeed}}ms</span>
                </div>

                <!-- Current Date Display -->
                <div *ngIf="currentAnimationDate" style="margin-top: 10px; font-weight: bold; color: #666;">
                    Current Date: {{currentAnimationDate | date:'medium'}}
                </div>
            </div>

            <div #circularTimeline class="chart-container"></div>
        </div>

        <!-- 10. Analytics Dashboard -->
        <div *ngIf="activeViz === 9" class="visualization">
            <h2>Analytics Dashboard</h2>
            <div class="dashboard-grid">
                <div class="dashboard-widget">
                    <h3>Event Distribution</h3>
                    <div #eventDistribution class="widget-chart"></div>
                </div>
                <div class="dashboard-widget">
                    <h3>Timeline Progress</h3>
                    <div #timelineProgress class="widget-chart"></div>
                </div>
                <div class="dashboard-widget">
                    <h3>Entity Activity</h3>
                    <div #entityActivity class="widget-chart"></div>
                </div>
                <div class="dashboard-widget">
                    <h3>Key Metrics</h3>
                    <div class="metrics">
                        <div class="metric">
                            <span class="metric-value">{{totalEvents}}</span>
                            <span class="metric-label">Total Events</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">{{uniqueEntities}}</span>
                            <span class="metric-label">Entities Involved</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">{{timespan}}</span>
                            <span class="metric-label">Days Span</span>
                        </div>
                    </div>
                </div>
            </div>
            <cve-timeline></cve-timeline>
        </div>
    </div>
</div>